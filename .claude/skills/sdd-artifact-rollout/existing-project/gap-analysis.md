# 既存プロジェクトのギャップ診断

既存プロジェクトにSDD準拠のアーティファクトを導入する際の、現状分析と優先順位付けガイド。

## 診断の目的

1. **現状把握**: 何がすでに存在し、何が欠けているかを明確化
2. **優先順位付け**: 限られたリソースでどこから着手すべきか判断
3. **ロードマップ作成**: 段階的な文書化計画の策定

---

## ギャップ診断チェックリスト

以下のチェックリストを使って、現在のプロジェクト状態を診断する。

### レイヤー1: ドメイン基礎（最重要）

```markdown
## ドメイン基礎の診断

### Domain Vision Statement
- [ ] プロジェクトの目的・価値が明文化されている
- [ ] スコープ（IN/OUT）が明確に定義されている
- [ ] 成功指標が定量的に設定されている
- [ ] ステークホルダーが特定されている

**現状**: □なし □部分的 □完備
**場所**: ________________

### Glossary（用語集）
- [ ] ドメイン用語の定義が存在する
- [ ] 用語の型（Entity/VO/Enum等）が明記されている
- [ ] 不変条件（Invariants）が記載されている
- [ ] 同義語・類義語の整理がされている
- [ ] コード内の命名と一致している

**現状**: □なし □部分的 □完備
**場所**: ________________
**推定用語数**: ____個

### Context Map（コンテキスト境界）
- [ ] Bounded Contextが識別されている
- [ ] 各コンテキストの責務が明確
- [ ] コンテキスト間の関係が定義されている
- [ ] 外部システムとの境界が明確

**現状**: □なし □部分的 □完備
**場所**: ________________
```

### レイヤー2: 要件定義

```markdown
## 要件定義の診断

### User Stories
- [ ] ユーザーストーリーが存在する
- [ ] As/I want/So that形式で記述されている
- [ ] 優先順位が設定されている
- [ ] ストーリーポイントが見積もられている

**現状**: □なし □部分的 □完備
**場所**: ________________
**推定ストーリー数**: ____個

### Acceptance Criteria（受け入れ基準）
- [ ] 各ストーリーにACが存在する
- [ ] Given-When-Then形式で記述されている
- [ ] エラーケースが網羅されている
- [ ] 形式的制約（述語論理）が記述されている

**現状**: □なし □部分的 □完備

### Feature Breakdown
- [ ] Epic/Feature/Storyの階層構造がある
- [ ] 依存関係が明示されている
- [ ] 優先順位順に整理されている

**現状**: □なし □部分的 □完備
```

### レイヤー3: ドメイン設計

```markdown
## ドメイン設計の診断

### Domain Model
- [ ] Aggregate/Entity/VOの区別が明確
- [ ] 不変条件がコードで表現されている
- [ ] ビジネスロジックがドメイン層にある
- [ ] 貧血ドメインモデルになっていない

**現状**: □なし □部分的 □完備
**場所**: ________________

### Domain Events
- [ ] 状態遷移がイベントで表現されている
- [ ] イベント名が過去形動詞になっている
- [ ] イベントフローが文書化されている
- [ ] 購読者（Subscriber）が明確

**現状**: □なし □部分的 □完備

### Service Specifications
- [ ] Application Serviceの責務が明確
- [ ] Domain Serviceの責務が明確
- [ ] 入出力の型が定義されている
- [ ] エラーケースが列挙されている

**現状**: □なし □部分的 □完備
```

### レイヤー4: データ・API設計

```markdown
## データ・API設計の診断

### Data Model
- [ ] ERダイアグラムが存在する
- [ ] テーブル定義書がある
- [ ] 制約（CHECK, FK）が文書化されている
- [ ] インデックス戦略が記録されている

**現状**: □なし □部分的 □完備
**場所**: ________________

### API Specifications
- [ ] OpenAPI/Swagger仕様書が存在する
- [ ] 全エンドポイントが網羅されている
- [ ] リクエスト/レスポンススキーマがある
- [ ] エラーレスポンスが定義されている

**現状**: □なし □部分的 □完備
**場所**: ________________
**推定エンドポイント数**: ____個
```

### レイヤー5: 運用・決定記録

```markdown
## 運用・決定記録の診断

### Architecture Decision Records (ADR)
- [ ] 主要な設計判断が記録されている
- [ ] 各ADRに背景・決定・結果がある
- [ ] 代替案が記載されている
- [ ] ステータス管理されている

**現状**: □なし □部分的 □完備
**場所**: ________________
**推定ADR数**: ____個

### 技術的負債の記録
- [ ] 既知の負債が一覧化されている
- [ ] 負債の理由が記録されている
- [ ] 解消計画がある

**現状**: □なし □部分的 □完備

### CI/CD・検証自動化
- [ ] アーティファクト検証がCI/CDに組み込まれている
- [ ] 用語一貫性チェックがある
- [ ] スキーマ検証がある

**現状**: □なし □部分的 □完備
```

---

## 成熟度マトリクス

診断結果を以下のマトリクスにマッピングする。

| レベル | 状態 | 特徴 |
|--------|------|------|
| **L0: なし** | アーティファクトが存在しない | コード以外に情報源がない |
| **L1: 断片的** | 一部のみ存在、形式不統一 | README、コメント、Wikiに散在 |
| **L2: 部分的** | 主要部分は存在、更新遅れ | 古い仕様書、実装と乖離 |
| **L3: 体系的** | 全体が存在、形式統一 | 構造化されているが検証なし |
| **L4: 検証済み** | 自動検証あり、CI/CD統合 | SDD準拠、AI活用可能 |

### 成熟度評価シート

```markdown
| アーティファクト | 現在レベル | 目標レベル | ギャップ |
|------------------|------------|------------|----------|
| Domain Vision    | L__        | L__        | __       |
| Glossary         | L__        | L__        | __       |
| Context Map      | L__        | L__        | __       |
| User Stories     | L__        | L__        | __       |
| Acceptance Criteria | L__     | L__        | __       |
| Domain Model     | L__        | L__        | __       |
| Domain Events    | L__        | L__        | __       |
| Data Model       | L__        | L__        | __       |
| API Specs        | L__        | L__        | __       |
| ADRs             | L__        | L__        | __       |
```

---

## 優先順位付けフレームワーク

### 評価軸

各アーティファクトを以下の3軸で評価する（各1-5点）：

| 軸 | 説明 | 高スコアの例 |
|----|------|--------------|
| **影響度** | 欠如による問題の深刻さ | 新メンバーのオンボーディング困難、バグ頻発 |
| **依存度** | 他アーティファクトの前提条件か | GlossaryはすべてのベースなのでHigh |
| **実現容易性** | 作成にかかる労力の逆数 | 既存コードから自動抽出可能ならHigh |

### 優先順位スコア計算

```
優先順位スコア = 影響度 × 依存度 × 実現容易性
```

### 優先順位評価シート

```markdown
| アーティファクト | 影響度 | 依存度 | 実現容易性 | スコア | 優先順 |
|------------------|--------|--------|------------|--------|--------|
| Glossary         | __/5   | __/5   | __/5       | __     | __     |
| Context Map      | __/5   | __/5   | __/5       | __     | __     |
| Domain Vision    | __/5   | __/5   | __/5       | __     | __     |
| Domain Model     | __/5   | __/5   | __/5       | __     | __     |
| API Specs        | __/5   | __/5   | __/5       | __     | __     |
| ADRs             | __/5   | __/5   | __/5       | __     | __     |
| User Stories     | __/5   | __/5   | __/5       | __     | __     |
| Data Model       | __/5   | __/5   | __/5       | __     | __     |
```

---

## 推奨される着手順序

### 典型的な優先順位（既存プロジェクト）

1. **Glossary（用語集）** - すべての土台。コードから抽出可能
2. **Context Map** - システム全体像の把握に必須
3. **ADRs** - 過去の設計判断を失う前に記録
4. **API Specs** - 外部連携の契約として重要
5. **Domain Model** - コード品質改善の基盤
6. **Domain Vision** - 意外と後回しでOK（チームが暗黙的に理解している場合）
7. **User Stories/AC** - 新規開発がなければ低優先

### 状況別の調整

| 状況 | 優先度を上げるべきアーティファクト |
|------|----------------------------------|
| 新メンバーが頻繁に入る | Glossary, Domain Vision, Context Map |
| バグが多い | Domain Model（不変条件）, AC |
| 外部連携が多い | API Specs, Context Map |
| 設計判断の経緯が不明 | ADRs |
| マイクロサービス移行中 | Context Map, Domain Events |
| AI活用を進めたい | Glossary, AC（形式的制約） |

---

## 診断結果テンプレート

診断完了後、以下の形式でまとめる：

```markdown
# [プロジェクト名] SDD準拠度診断結果

## 診断日
YYYY-MM-DD

## 診断者
[名前/役割]

## サマリー

### 成熟度スコア
- 現在: L__.__ （平均）
- 目標: L__.__ 

### 主要なギャップ
1. [最も深刻なギャップ]
2. [次に深刻なギャップ]
3. [3番目のギャップ]

## 優先着手アーティファクト

| 順位 | アーティファクト | 理由 | 推定工数 |
|------|------------------|------|----------|
| 1    |                  |      |          |
| 2    |                  |      |          |
| 3    |                  |      |          |

## 推奨アクション

### 短期（1-2週間）
- [ ] [アクション1]
- [ ] [アクション2]

### 中期（1-2ヶ月）
- [ ] [アクション3]
- [ ] [アクション4]

### 長期（3ヶ月以上）
- [ ] [アクション5]
```

---

## 次のステップ

診断完了後：

1. **抽出作業に進む** → [reverse-engineering.md](reverse-engineering.md)
2. **暗黙知の収集に進む** → [knowledge-extraction.md](knowledge-extraction.md)
3. **移行計画を立てる** → [migration-roadmap.md](migration-roadmap.md)
