# アプリケーション設定要件

## ドキュメント情報

- **作成日**: 2025-11-18
- **バージョン**: 2.0（ユーザーゴール単位での再設計）
- **対象ユースケース**: UC-APP-01 〜 UC-APP-02（2個のユースケース）
- **関連設計**: [自動更新](./AUTO_UPDATE.md), [ログ設定](../CLAUDE.md#logging-configuration)
- **注記**: 自動更新機能（旧UC-APP-01,02）は非機能要件として扱われ、このドキュメントから削除されました。

---

## 改訂履歴

**v2.0 (2025-11-18)**
- ユーザーゴール単位での再設計（3個 → 2個のユースケース）
- 旧UC-APP-01,02（更新確認、インストール）を削除（自動更新は非機能要件）
- 旧UC-APP-03を UC-APP-01（データベースを初期化する）に変更
- UC-APP-02（アプリケーションログを確認する）を新規追加

**v1.0 (初版)**
- 基本的なアプリケーション管理機能

---

## 1. UC-APP-01: データベースを初期化する

### 1.1 ユースケース概要

開発環境でデータベースを初期状態にリセットします。本番環境では利用できません。

### 1.2 事前条件

- The システム shall 開発環境で実行されている（`app.isPackaged === false`）
- The システム shall 設定画面が表示されている

### 1.3 事後条件

- The システム shall データベースファイルが削除されている
- The システム shall アプリケーションが再起動され、新しい空のデータベースが作成されている

### 1.4 要件

#### 1.4.1 リセット操作

**1. リセットボタンの提供**

The システム shall 設定画面の「詳細設定」セクションにデータベースリセットボタンを提供する

**2. 本番環境での非表示**

If アプリケーションがパッケージ化されている（本番環境）, the システム shall データベースリセットボタンを非表示にする

**3. 確認ダイアログの表示**

When ユーザーがリセットボタンをクリックした, the システム shall 確認ダイアログを表示し、操作の取り消し不可を警告する

**4. データベースファイルの削除**

When ユーザーがリセットを確認した, the システム shall SQLiteデータベースファイル（`./tmp/db/app.db`）を削除する

**5. アプリケーションの再起動**

When データベースファイルが削除された, the システム shall アプリケーションを自動的に再起動する

#### 1.4.2 エラーハンドリング

**6. ファイル削除失敗時の処理**

If データベースファイルの削除に失敗した, the システム shall エラーメッセージを表示し、ログに詳細を記録する

**7. 本番環境での誤実行防止**

If 本番環境でリセットが試みられた, the システム shall 操作を拒否し、エラーメッセージを表示する

---

## 2. UC-APP-02: アプリケーションログを確認する

### 2.1 ユースケース概要

システムログファイルを表示・確認します。

### 2.2 事前条件

- The システム shall アプリケーションが起動している
- The システム shall ログファイルが存在する

### 2.3 事後条件

- The システム shall ログファイルの内容が表示されている

### 2.4 要件

#### 2.4.1 ログ表示操作

**8. ログ表示ボタンの提供**

The システム shall 設定画面の「詳細設定」セクションにログ表示ボタンを提供する

**9. ログファイルパスの表示**

The システム shall 現在のログファイルパス（開発環境: `./tmp/logs/app.log`、本番環境: `userData/logs/app.log`）を表示する

**10. ログファイルをシステムエディタで開く**

When ユーザーがログ表示ボタンをクリックした, the システム shall OSのデフォルトテキストエディタでログファイルを開く

**11. ログディレクトリをファイルマネージャーで開く**

The システム shall ログディレクトリをOSのファイルマネージャー（Explorer、Finder等）で開くオプションを提供する

#### 2.4.2 ログファイル情報の表示

**12. ログファイルサイズの表示**

The システム shall 現在のログファイルサイズ（MB単位）を表示する

**13. ローテーション情報の表示**

The システム shall ログファイルのローテーション設定（5MB制限）を表示する

**14. ログレベルの表示**

The システム shall 現在のログレベル（開発: debug、本番: info）を表示する

#### 2.4.3 エラーハンドリング

**15. ログファイル不在時の処理**

If ログファイルが存在しない, the システム shall 「ログファイルがまだ作成されていません」というメッセージを表示する

**16. ファイルオープン失敗時の処理**

If ログファイルを開くことができない, the システム shall エラーメッセージとファイルパスを表示する

---

## 3. テスト可能性

### 3.1 受け入れテストシナリオ

**シナリオ1: データベースリセット（開発環境）**
1. 開発環境でアプリケーションを起動
2. いくつかのAIプロバイダー設定とチャットセッションを作成
3. 設定画面の「詳細設定」を開く
4. 「データベースをリセット」ボタンが表示されていることを確認
5. ボタンをクリック
6. 確認ダイアログが表示され、警告メッセージを確認
7. リセットを確認
8. アプリケーションが自動的に再起動することを確認
9. チャット画面で「No AI Provider Configured」エラーが表示されることを確認（データベースがリセットされた）

**シナリオ2: ログ確認**
1. アプリケーションを起動
2. いくつかの操作を実行（チャット、設定変更等）
3. 設定画面の「詳細設定」を開く
4. 現在のログファイルパスとサイズが表示されることを確認
5. 「ログを表示」ボタンをクリック
6. OSのデフォルトテキストエディタでログファイルが開くことを確認
7. ログに実行した操作が記録されていることを確認

### 3.2 検証基準

- データベースリセットが開発環境でのみ実行可能である
- データベースリセット後、全てのデータが削除され、アプリケーションが再起動する
- 本番環境ではデータベースリセットボタンが表示されない
- ログファイルパスとサイズが正しく表示される
- ログファイルをシステムエディタで開くことができる
- ログに全てのプロセス（Main、Backend、Renderer）の出力が統合されている

---

## 4. 非機能要件

### 4.1 セキュリティ

**NFR-1: 本番環境でのデータ保護**

The システム shall 本番環境でデータベースリセット機能を無効化し、ユーザーデータを保護する

### 4.2 ユーザビリティ

**NFR-2: 確認ダイアログの明確性**

The システム shall データベースリセット時の確認ダイアログに操作の影響を明確に説明する

**NFR-3: ログアクセスの容易性**

The システム shall ユーザーがワンクリックでログファイルにアクセスできるようにする

---

## 5. 関連文書

- [要件定義概要](./REQUIREMENTS_OVERVIEW.md)
- [自動更新設計](./AUTO_UPDATE.md)
- [プロジェクトREADME - ログ設定](../CLAUDE.md#logging-configuration)
- [プロジェクトREADME - データベース設定](../CLAUDE.md#database-configuration)

---

**作成者メモ**: 本文書（v2.0）はユーザーゴール単位での再設計版です。自動更新機能は非機能要件として扱われるため、このドキュメントから削除しました。全ての要件はEARSフォーマットに従い、テスト可能な形式で記述されています。
