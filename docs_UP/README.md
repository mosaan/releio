# 統一プロセス成果物ディレクトリ

本ディレクトリは、「UMLによる統一ソフトウェア開発プロセス」に基づいて整理された成果物を格納しています。

---

## 命名規則

成果物ファイルは、ワークフロー区分をプレフィックスとして付与します。
- 形式: `<ワークフロー区分>_<成果物名>.md`
- 想定プレフィックス: `要求_`, `分析_`, `設計_`, `実装_`, `テスト_`
- 例: `要求_ユースケースモデル.md`, `分析_ユースケース実現.md`

---

## ディレクトリ構成

```
docs_UP/
├── README.md                      # 本ファイル（概要説明）
├── 要求_特色リスト.md                   # 要求候補のリスト
├── 要求_ユースケースモデル.md           # アクターとユースケースのモデル
├── 要求_ドメインモデル.md               # システムの外界を表現するモデル
├── 要求_補足要求の仕様書.md            # 機能外要求などの補足的な要求
├── 分析_分析モデル.md                  # バウンダリ/コントロール/エンティティのラフ構造
├── 分析_ユースケース実現.md           # 全主要ユースケースの実現シナリオ
├── 分析_ソフトウェアアーキテクチャ記述.md # 4+1ビュー骨格と主要メカニズムの予備版
├── 設計_設計モデル.md                  # サブシステム/レイヤー構成と設計メカニズムの骨子
├── 設計_配置モデル.md                  # ノード・プロセス配置と外部依存の関係（方向づけ版）
├── 設計_アーキテクチャ決定ログ.md      # 設計観点の意思決定ログ
├── 設計_ユースケース設計.md            # ユースケースの設計レベル責務とインターフェイス
└── テスト_テスト戦略.md                # 現行テスト資産と改善計画の整理（方向づけ版）
```

---

## 成果物の説明

### 1. 特色リスト（Feature List）

**ファイル**: [要求_特色リスト.md](要求_特色リスト.md)

**責任ワーカー**: （明示的なワーカーなし、作業立案に使用）

**概要**:
プロジェクトの要求候補を列挙したリストです。既存の実装と設計文書から抽出された特色が、カテゴリごとに整理されています。各特色には、説明、優先度、実装状態、関連文書が記載されています。

**使い方**:
- 反復の作業立案時に、どの特色を次に実装するかを検討する際に参照します
- 新しい要求が発生した際に、このリストに追加します
- 優先度の見直しや、実装状態の更新を行います

---

### 2. ユースケースモデル（Use-Case Model）

**ファイル**: [要求_ユースケースモデル.md](要求_ユースケースモデル.md)

**責任ワーカー**: システム分析者、ユースケース定義者

**概要**:
システムと相互作用するアクター（エンドユーザー、AIプロバイダー、MCPサーバーなど）と、システムが提供する主要なユースケース（UC-01からUC-07）を記述しています。各ユースケースには、基本フロー、代替フロー、前提条件、事後条件が詳細に記載されています。

**使い方**:
- システムの責任範囲を理解する際に参照します
- 新しい機能を追加する際に、どのユースケースに該当するかを確認します
- 設計や実装の際に、ユースケースのフローを基に詳細化します
- テストケースを作成する際に、ユースケースのシナリオを基にします

**主要なユースケース**:
- **UC-01**: AIと会話する（アーキテクチャ上最も重要）
- **UC-02**: 会話セッションを管理する
- **UC-03**: AI設定を管理する
- **UC-04**: MCPサーバーを管理する
- **UC-05**: ネットワーク設定を管理する
- **UC-06**: アプリケーションを更新する
- **UC-07**: 会話履歴を圧縮する（システム内部）

---

### 3. ドメインモデル（Domain Model）

**ファイル**: [要求_ドメインモデル.md](要求_ドメインモデル.md)

**責任ワーカー**: ビジネスモデル作成者

**概要**:
AIチャットアプリケーションのドメインにおける主要な概念（会話セッション、メッセージ、AIプロバイダー、MCPサーバーなど）とそれらの関係を記述しています。各エンティティの属性、関連、ビジネスルールが詳細に記載されています。

**使い方**:
- システムが扱う概念とその関係を理解する際に参照します
- データベーススキーマを設計する際の基礎として使用します
- 分析・設計フェーズで、分析クラスや設計クラスを洗い出す際の出発点とします
- ドメイン用語の定義を確認する際に参照します

---

### 4. 用語集（Glossary）

**ファイル**: （未作成、現在はドメインモデルに内包）

**責任ワーカー**: システム分析者

**概要**:
重要な概念や共通語彙を定義し、ユースケース記述や分析・設計で用語の一貫性を保つための成果物です。開発者の間でさまざまな概念や意味の定義について同じ見解を持ち、一般的な考え違いのリスクを減少させるために非常に便利です。

**使い方**:
- ビジネスモデルまたはドメインモデルから導き出し、システムに焦点を絞った用語を管理します
- ユースケースを定義するときやユーザーインターフェイスを記述するときに参照します
- 顧客や外部の人たちと話し合うときに意図を簡単に伝えられるようにします

**現状**:
- 現在は[要求_ドメインモデル.md](要求_ドメインモデル.md)に用語集が内包されています
- 今後、プロジェクトの成長に応じて独立した成果物として分離することを検討します

---

### 5. ユーザーインターフェイスのプロトタイプ

**ファイル**: （未作成）

**責任ワーカー**: ユーザーインターフェイスデザイナー

**概要**:
ユーザーインターフェイスの外観をデザインし、要求把握のときに人間のアクターとシステムとの間の相互作用を理解したり指定したりするための成果物です。より良いユーザーインターフェイスを開発するのに役立つだけでなく、ユースケースもより深く理解できるようになります。

**使い方**:
- 要求把握時に、システムのUIイメージを具体化します
- ユーザーと開発者の間で、システムの外観や操作性について合意を形成します
- ユースケースの詳細化やユーザビリティ要求の検証に活用します

**現状**:
- 未着手（反復2以降で必要に応じて作成予定）
- UIプロトタイプやユースケースビューのアーキテクチャ説明書の作成が必要

---

### 6. 補足要求の仕様書（Supplementary Specification）

**ファイル**: [要求_補足要求の仕様書.md](要求_補足要求の仕様書.md)

**責任ワーカー**: システム分析者

**概要**:
特定のユースケースに固有ではない、システム全体に適用される要求を記述しています。以下のカテゴリに分類されています：

1. **機能要求**: データ永続化、ログ記録、IPC
2. **ユーザビリティ要求**: レスポンス時間、フィードバック、アクセシビリティ
3. **信頼性要求**: エラー処理、データ整合性、フォールトトレランス
4. **パフォーマンス要求**: 応答時間、スループット、リソース使用量
5. **サポート性要求**: ログ記録、診断機能
6. **セキュリティ要求**: 認証情報の保護、ネットワークセキュリティ、プロセス分離
7. **実装制約**: 技術スタック、コード品質、ビルドとパッケージング
8. **インターフェイス要求**: UI、外部システムインターフェイス
9. **プラットフォーム要求**: サポートするプラットフォーム、プラットフォーム固有の制約
10. **ライセンスとオープンソース要求**
11. **法的、規制、標準要求**

**使い方**:
- システムの品質属性や制約を理解する際に参照します
- 設計や実装の際に、これらの要求を満たすように考慮します
- テスト計画を立案する際に、これらの要求を検証するテストケースを作成します

---

### 7. 分析モデル（Analysis Model）

**ファイル**: [分析_分析モデル.md](分析_分析モデル.md)

**責任ワーカー**: システム分析者、アーキテクト

**概要**:
方向づけフェーズで作成した荒削りな分析モデルです。Renderer/Backendの主要なバウンダリ・コントロール・エンティティを整理し、アーキテクチャ説明のためのパッケージビューを示しています。

**使い方**:
- アーキテクチャ候補を説明・議論する際の共通参照に使います
- ユースケース実現や設計モデルへのブリッジとして、責務分担を検証する際に参照します
- 後続反復での詳細化（クラス間の制約・例外フロー）に向けたベースラインとします

---

### 8. ユースケース実現（UC-01〜UC-07）

**ファイル**: [分析_ユースケース実現.md](分析_ユースケース実現.md)

**責任ワーカー**: システム分析者、ユースケース定義者

**概要**:
全主要ユースケース（AI会話、セッション管理、AI設定管理、MCP管理、ネットワーク設定、アプリ更新、会話圧縮）の実現シナリオを、バウンダリ/コントロール/エンティティのやり取りとして示したものです。Renderer/Main/Backendの責務境界をPlantUMLでラフに図示しています。

**使い方**:
- AIストリーミングやMCP連携、設定管理、圧縮などの流れを確認し、設計・実装時の制約を把握します
- 例外フローや性能要件を追加するときのたたき台にします
- テストケース分解（保存/削除/接続テスト/圧縮有無など）や契約精緻化の参照にします

---

### 9. ソフトウェアアーキテクチャ記述（Software Architecture Document）

**ファイル**: [分析_ソフトウェアアーキテクチャ記述.md](分析_ソフトウェアアーキテクチャ記述.md)

**責任ワーカー**: アーキテクト

**概要**:
4+1ビューの骨格（論理/プロセス/開発/配置 + シナリオ）を用いて、3プロセス構成やAIストリーミング、MCP統合、圧縮メカニズムなど主要な設計決定をまとめた予備版です。

**使い方**:
- 方向づけフェーズにおける実現性評価・リスク整理の土台として利用します
- 推敲フェーズ以降で詳細化する際のセクション構成と用語の足並みを揃えます
- 新規メカニズム追加時の影響範囲確認に活用します

---

### 10. 設計モデル（Design Model）

**ファイル**: [設計_設計モデル.md](設計_設計モデル.md)

**責任ワーカー**: アーキテクト、デザイナ

**概要**:
3プロセス構成に対してサブシステム/レイヤーを整理し、主要コンポーネントの責務メモと設計メカニズム（IPC、ストリーミング、圧縮、アップデート、プロキシ/証明書）の扱い方針を示した骨子です。方向づけフェーズでの共通足場となるよう最小限の内容に留めています。

**使い方**:
- 分析モデルを設計クラス/コンポーネントへ写像する際の出発点として利用します
- 推敲フェーズで例外フローや契約を詳細化する際のセクション構成を揃えます
- 実装との照合（`src/backend/handler.ts`, `ai/stream.ts`, `mcp/manager.ts` 等）により責務の漏れを確認します

---

### 11. ユースケース設計（補完版）

**ファイル**: [設計_ユースケース設計.md](設計_ユースケース設計.md)

**責任ワーカー**: アーキテクト、ユースケースエンジニア

**概要**:
追加ユースケース（UC-02/03/05/06/07）の設計レベル責務、IPCインターフェイス、エラー設計を現行コードに合わせて整理した補完資料です。Backend/Renderer/Mainの役割分担とDBマッピングを明記し、設計メカニズムへのトレースを容易にします。

**使い方**:
- インターフェイス変更時の影響範囲確認に利用します
- 設計モデル/配置モデルと突き合わせて責務の漏れ・重複を検出します
- テストケース・モック作成時の前提条件（Resultラッパー、エラー動作）を確認する際に参照します

---

### 12. 配置モデル（Deployment Model）

**ファイル**: [設計_配置モデル.md](設計_配置モデル.md)

**責任ワーカー**: アーキテクト、デプロイ担当

**概要**:
Main/Backend/Rendererの配置と外部依存（AI Provider/MCP Server/Update Server）への接続関係、開発・本番のパス差分を示したたたき台です。セキュリティ境界とログ/DBの配置を明確にし、今後のフォールトトレランス検討のベースにします。

**使い方**:
- パッケージングや配布形態の影響を確認する際に参照します
- ネットワーク設定（プロキシ/証明書）の適用箇所を把握し、障害調査の起点とします
- 推敲フェーズで再接続戦略や上限設定を設計する際の前提資料とします

---

### 13. アーキテクチャ決定ログ（Architecture Decision Log）

**ファイル**: [設計_アーキテクチャ決定ログ.md](設計_アーキテクチャ決定ログ.md)

**責任ワーカー**: アーキテクト

**概要**:
方向づけフェーズで暗黙に選択されていた設計判断（3プロセス分離、ストリーミング集約、MCPプロセス管理、圧縮戦略、更新方式、プロキシ/証明書方針等）を明文化し、今後の変更管理に備える決定ログです。検討中の論点も`Proposed`として列挙しています。

**使い方**:
- 新しい設計判断を追加する際にID/Status/日付を付与し、根拠を残します
- 決定がコードに反映されたら関連ファイル/モジュールを追記し、影響範囲を可視化します
- 廃止や差し替えが発生した場合、`Superseded`等に更新し代替IDを紐付けます

---

### 14. 実装モデル（Implementation Model）

**ファイル**: （未作成）

**責任ワーカー**: アーキテクト

**概要**:
コンポーネント（実行可能ファイル、ライブラリ、ソースファイル、データファイルなど）に基づいて、設計要素をどのように実装するかを記述します。設計モデルの要素を物理的にパッケージ化し、ビルドシステムとの対応を明確にします。

**使い方**:
- 設計モデルから実装への写像を明確にします
- ビルドシステム、パッケージング戦略、配布形態を設計する際の基礎とします
- コンポーネント間の依存関係を管理し、アーキテクチャの整合性を保証します

**現状**:
- 未作成（反復2以降で作成予定）
- 現状はソースツリー参照のみで、推敲フェーズのアーキテクチュラルベースラインを明文化する成果物を追加する必要がある

---

### 15. 統合化ビルド計画（Integration Build Plan）

**ファイル**: （未作成）

**責任ワーカー**: システム統合担当者

**概要**:
各反復で作成する必要がある一連のビルドの計画と、各部分を実装したときのビルドの統合が含まれます。段階的な統合戦略とビルドの順序を定義し、リスクを最小化します。

**使い方**:
- 反復計画時に、どのコンポーネントをどの順序でビルド・統合するかを決定します
- 統合リスクを早期に発見し、対処するための戦略を立案します
- CI/CDパイプラインの設計とビルド自動化の基礎とします

**現状**:
- 未作成（反復2以降で作成予定）
- 現在は既存のビルドシステム（electron-vite, Drizzle Kit, Vitest）を参照

---

### 16. テスト戦略（Test Strategy）

**ファイル**: [テスト_テスト戦略.md](テスト_テスト戦略.md)

**責任ワーカー**: テスト設計者、QAエンジニア

**概要**:
現行のテスト資産（Backend/RendererのVitest構成、セットアップ、既知の失敗テスト）と環境依存、改善すべき課題を整理した方向づけフェーズ向けテスト戦略です。WIPテストの課題（ロガー/DB初期化順序、モック不足など）と次反復での優先改善項目をまとめています。

**使い方**:
- テスト実行時の環境設定（`MAIN_VITE_USER_DATA_PATH` など）や既知の失敗テストを事前に確認する。
- 次反復で追加すべきテスト（UIカバレッジ、統合テスト、MCP/再接続のスモーク）を計画する際の起点として利用する。
- インフラ改善（依存注入、ロガー遅延初期化など）のタスク化に活用する。

---

### 17. テストモデル（Test Model）

**ファイル**: （未作成）

**責任ワーカー**: テスト設計者

**概要**:
テストの設計、テストの実施方針、リソース、スケジュールを定義します。テストケース、テストプロシージャ、テストコンポーネントを包含する上位レベルのモデルで、テスト戦略を具体化したものです。

**使い方**:
- テストの全体像を把握し、テストアーキテクチャを設計します
- テストケースとテストプロシージャの関係を整理します
- テストリソースの割り当てとスケジュール管理の基礎とします

**現状**:
- 未作成（反復2以降で作成予定）
- テスト戦略を詳細化し、具体的なテストケースとプロシージャに展開する必要がある

---

### 18. テストケース（Test Case）

**ファイル**: （未作成）

**責任ワーカー**: テスト設計者

**概要**:
何をテストするかを指定し、検証可能な要求を検証するために考案されます。各テストケースは、入力、期待される結果、実行条件を明確に定義します。ユースケースや補足要求の仕様書から導出されます。

**使い方**:
- ユースケースや要求から体系的にテストケースを導出します
- テストカバレッジを測定し、テストの網羅性を保証します
- テストプロシージャの基礎として、実行手順を詳細化します

**現状**:
- 未作成（反復2以降で作成予定）
- 既存のテストコード（Vitest）から逆にテストケースを抽出・文書化する必要がある

---

### 19. テストプロシージャ（Test Procedure）

**ファイル**: （未作成）

**責任ワーカー**: テスト設計者

**概要**:
テストを実行する方法を指定します。テストケースを実際に実行するための具体的な手順、実行順序、必要な環境設定を記述します。手動テストと自動テストの両方をカバーします。

**使い方**:
- テストケースを実行可能な手順に展開します
- テスト環境のセットアップと事前条件を明確にします
- テスト実行者（人間またはCI/CD）への指示書として機能します

**現状**:
- 未作成（反復2以降で作成予定）
- 既存のテストコードとCI設定から、実行手順を文書化する必要がある

---

### 20. テストコンポーネント（Test Component）

**ファイル**: （未作成）

**責任ワーカー**: コンポーネントエンジニア

**概要**:
自動化された一部のテストプロシージャを含みます。テストドライバ、テストスタブ、モック、テストハーネスなど、自動テストを実行するためのコードやスクリプトを指します。

**使い方**:
- テストプロシージャを自動化するためのコードを実装します
- モックやスタブを作成し、依存関係を分離します
- テストハーネスを構築し、テスト実行環境を整備します

**現状**:
- 部分的に存在（Vitestテストコード、モック）
- 体系的な整理と文書化が必要（テストユーティリティ、共通モック、テストヘルパーなど）

---

### 21. テスト評価書（Test Evaluation Summary）

**ファイル**: （未作成）

**責任ワーカー**: テスト設計者

**概要**:
テスト作業の結果を評価したものです。テスト実行の結果、発見された欠陥、テストカバレッジ、品質メトリクスなどを集約し、リリース判断の材料とします。

**使い方**:
- テスト実行結果を集約し、品質状況を報告します
- 発見された欠陥の傾向を分析し、品質改善策を提案します
- リリース可否の判断材料として、ステークホルダーに提示します

**現状**:
- 未作成（反復2以降で作成予定）
- CI/CDからのテスト結果やカバレッジレポートを基に、評価書のフォーマットを整備する必要がある

---

## 進捗管理

プロジェクトの進捗状況は、[.agent/UP_PROGRESS.md](../.agent/UP_PROGRESS.md) で管理されています。

**現在の状態**:
- **フェーズ**: 推敲（反復2開始）
- **反復**: 反復2
- **ワークフロー**: 設計・テスト（基盤強化）
- **作業**: Backendテスト基盤のテスタビリティ向上とMessagePort再接続戦略（AD-007）設計に着手

---

## 今後の作業

### 反復1（完了報告）:
- 設計成果物初版（設計モデル/配置モデル/アーキテクチャ決定ログ）の整合レビュー準備を完了
- テスト戦略を現状の実装に基づき文書化（Backend/Rendererテスト資産と既知の課題を整理）
- 反復2で対応すべき`Proposed`論点とテスト改善アイテムを抽出済み

### 反復2の目標（優先順）:
1. Backendテスト基盤のテスタビリティ向上（ロガー遅延初期化、DB接続のDI）で`proxy/cert/fetch`系をグリーンにする
2. MessagePort再配布・再接続戦略の設計とAD-007確定（Renderer/Main/Backendの再接続シーケンス定義）
3. 圧縮閾値・保持ポリシーの設定化（AD-008）とUI/設定スキーマ変更方針の整理
4. MCP並列上限とリソース管理（AD-009）の設計とテレメトリ要件の定義
5. Renderer UIテスト拡充（SessionList/ChatPanel/ストリーミング表示のハッピー/エラー経路）とIPCモック強化
6. 分析モデル/ユースケース実現の精緻化（重要ユースケース全体へ拡大し例外パスを追加）
7. 設計モデル/配置モデルの詳細化とアーキテクチュラルベースライン計画の明文化
8. テスト計画の自動化枠組み（カバレッジ収集とCIゲートの暫定値設定）

---

## 反復2序盤の作業棚卸し（ワークフロー別）

- **要求**: `要求_ユースケースモデル.md`でアクター洗い出しと優先度づけ・基本/代替フローの骨子を方向づけ版として整備済み。`要求_ドメインモデル.md`に用語集を内包。UIプロトタイプやユースケースビューのアーキテクチャ説明書は未着手で、UC-05/06/07の例外フロー厚み付けが必要。
- **分析**: `分析_分析モデル.md`と`分析_ユースケース実現.md`で全主要UC（UC-01〜07）のラフな実現とBCE責務を提示。今後は例外/制約の厚み付けとサービスパッケージ整理が必要。`分析_ソフトウェアアーキテクチャ記述.md`は骨格レベルの4+1ビューのみで詳細化が必要。
- **設計**: `設計_設計モデル.md`と`設計_配置モデル.md`の骨子および`設計_アーキテクチャ決定ログ.md`のProposed論点（AD-007/AD-008/AD-009）を保持。ユースケース設計・インターフェイス仕様・サービスサブシステム定義は未着手で、AD-007〜009確定に向けた設計/決定ログ更新が必要。
- **実装**: 実装モデル、統合化ビルド計画、実装サブシステムの成果物は未作成。現状はソースツリー参照のみで、推敲フェーズのアーキテクチュラルベースラインを明文化する成果物を追加する必要がある。
- **テスト**: `テスト_テスト戦略.md`で現状と課題を整理済み。テスト計画書、テストケース/プロシージャ、テストコンポーネント、テスト評価書は未整備。反復2ではproxy/cert/fetch系のWIPテストのグリーン化、Renderer UIテストの拡充、カバレッジ収集/CIゲート方針の具体化が必要。

上記の棚卸しは`docs/UP_with_UML/統一プロセス：03_ワークフローとフェーズ別活動の要点.md`の作業一覧に基づく。次の反復で不足成果物の優先度づけと作成方針を具体化する。

---

## 関連文書

### 統一プロセスのリファレンス
- [統一プロセス：01_構成単位と要素.md](../UP_with_UML/統一プロセス：01_構成単位と要素.md)
- [統一プロセス：02_成果物と責任ワーカー.md](../UP_with_UML/統一プロセス：02_成果物と責任ワーカー.md)
- [統一プロセス：03_ワークフローとフェーズ別活動の要点.md](../UP_with_UML/統一プロセス：03_ワークフローとフェーズ別活動の要点.md)
- [ABOUT_THIS_FOLDER.md](../UP_with_UML/ABOUT_THIS_FOLDER.md)

### 既存の設計文書
本プロジェクトには、統一プロセス導入前に作成された多数の設計文書があります：
- [docs/MCP_INTEGRATION_DESIGN.md](../MCP_INTEGRATION_DESIGN.md)
- [docs/PROXY_AND_CERTIFICATE_DESIGN.md](../PROXY_AND_CERTIFICATE_DESIGN.md)
- [docs/CHAT_SESSION_PERSISTENCE.md](../CHAT_SESSION_PERSISTENCE.md)
- [docs/AUTO_UPDATE.md](../AUTO_UPDATE.md)
- その他多数（[docs/](../) ディレクトリを参照）

これらの既存文書と本ディレクトリの成果物を照らし合わせながら、統一プロセスに基づいた整理を進めていきます。

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-11-25 | 1.0 | 初版作成（反復1、方向づけフェーズ） |
| 2025-11-25 | 1.1 | 命名規則を追記し、ワークフロー区分プレフィックスに従ってファイル名を整理 |
| 2025-11-25 | 1.2 | テスト戦略ドキュメントを追加し、反復1完了の状態を反映 |
| 2025-11-25 | 1.3 | 反復2開始に伴い、現在の状態と反復2の目標を優先順で明記 |
| 2025-11-26 | 1.4 | 反復2序盤のワークフロー別作業棚卸しと不足成果物の整理を追加 |
| 2025-11-26 | 1.5 | 追加ユースケース（UC-02/03/05/06/07）の分析・設計補完資料を収録し構成表に反映 |
| 2025-11-26 | 1.6 | ユースケース実現ドキュメントを1本に統合し、ユースケース設計ドキュメントの命名を簡素化 |
| 2025-11-26 | 1.7 | 統一プロセス原著の全成果物を網羅的に追加（用語集、UIプロトタイプ、実装モデル、統合化ビルド計画、テストモデル、テストケース、テストプロシージャ、テストコンポーネント、テスト評価書）。FULLTEXT第2部と「02_成果物と責任ワーカー.md」を基準に成果物リストを完全化 |
